<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
   "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<head>
    <title>Erlib Documentation</title>
    <link rel="stylesheet" href="../ldoc.css" type="text/css" />
</head>
<body>

<div id="container">

<div id="product">
	<div id="product_logo"></div>
	<div id="product_name"><big><b></b></big></div>
	<div id="product_description"></div>
</div> <!-- id="product" -->


<div id="main">


<!-- Menu -->

<div id="navigation">
<br/>
<h1>ldoc</h1>

<ul>
  <li><a href="../index.html">Index</a></li>
</ul>

<h2>Contents</h2>
<ul>
<li><a href="#Concepts">Concepts</a></li>
<li><a href="#Commands">Commands </a></li>
<li><a href="#Events">Events </a></li>
<li><a href="#Remote_Interface">Remote Interface </a></li>
</ul>


<h2>Modules</h2>
<ul class="nowrap">
  <li><a href="../modules/Core.html">Core</a></li>
  <li><a href="../modules/Types.html">Types</a></li>
  <li><a href="../modules/Concepts.html">Concepts</a></li>
  <li><a href="../modules/Cache.html">Cache</a></li>
  <li><a href="../modules/Data.html">Data</a></li>
  <li><a href="../modules/Entity.html">Entity</a></li>
  <li><a href="../modules/EventManagerLite.html">EventManagerLite</a></li>
  <li><a href="../modules/Force.html">Force</a></li>
  <li><a href="../modules/Gui.html">Gui</a></li>
  <li><a href="../modules/Locale.html">Locale</a></li>
  <li><a href="../modules/Player.html">Player</a></li>
  <li><a href="../modules/PluginManagerLite.html">PluginManagerLite</a></li>
  <li><a href="../modules/Prototype.html">Prototype</a></li>
  <li><a href="../modules/Remote.html">Remote</a></li>
  <li><a href="../modules/Setting.html">Setting</a></li>
  <li><a href="../modules/Stacktrace.html">Stacktrace</a></li>
  <li><a href="../modules/Train.html">Train</a></li>
  <li><a href="../modules/Wube.html">Wube</a></li>
  <li><a href="../modules/Array.html">Array</a></li>
  <li><a href="../modules/Class.html">Class</a></li>
  <li><a href="../modules/Coding.html">Coding</a></li>
  <li><a href="../modules/Color.html">Color</a></li>
  <li><a href="../modules/Compare.html">Compare</a></li>
  <li><a href="../modules/Debug.html">Debug</a></li>
  <li><a href="../modules/Error.html">Error</a></li>
  <li><a href="../modules/Filter.html">Filter</a></li>
  <li><a href="../modules/Iter.html">Iter</a></li>
  <li><a href="../modules/Lambda.html">Lambda</a></li>
  <li><a href="../modules/LocalisedString.html">LocalisedString</a></li>
  <li><a href="../modules/Lock.html">Lock</a></li>
  <li><a href="../modules/Log.html">Log</a></li>
  <li><a href="../modules/Logic.html">Logic</a></li>
  <li><a href="../modules/Math.html">Math</a></li>
  <li><a href="../modules/Meta.html">Meta</a></li>
  <li><a href="../modules/Polygon.html">Polygon</a></li>
  <li><a href="../modules/Replicate.html">Replicate</a></li>
  <li><a href="../modules/Set.html">Set</a></li>
  <li><a href="../modules/String.html">String</a></li>
  <li><a href="../modules/Table.html">Table</a></li>
  <li><a href="../modules/Time.html">Time</a></li>
  <li><a href="../modules/Tool.html">Tool</a></li>
  <li><a href="../modules/Vector.html">Vector</a></li>
  <li><a href="../modules/Verificate.html">Verificate</a></li>
  <li><a href="../modules/Version.html">Version</a></li>
  <li><a href="../modules/remotes.html">remotes</a></li>
  <li><a href="../modules/snippet.html">snippet</a></li>
  <li><strong>Babelfish</strong></li>
</ul>
<h2>Source</h2>
<ul class="nowrap">
  <li><a href="../source/Introduction.html">Introduction</a></li>
</ul>

</div>

<div id="content">

<h1>Module <code>Babelfish</code></h1>
<p>Localised string search for mods.</p>
<p> Babelfish is a caching <strong>translator for prototype localisations</strong>.
 It automatically detects changes in localisation and updates the translation
 in the background. In Singleplayer this
 process happens during the loading screen and is invisible to the player.
 In Multiplayer translation is done gradually in on_tick to prevent
 network congestion. Each language is only translated once,
 so even in Multiplayer the process is instant for most players.</p>

<p> While translation is running a small status indicator in
 the upper right corner informs each user of the <em>approximate</em> total progress.
 However there is no such progress information on the API, as the
 Babelfish uses a SearchTypes priorization system in which i.e.
 <code>&quot;item_name</code>" may already be completely translated despite the indicator
 showing a low number like "10%".</p>

<p> <a href="../source/Introduction.html#DevelopmentStatus">Module Status</a>: Experimental.</p>


<h2><a href="#Concepts">Concepts</a></h2>
<table class="function_list">
	<tr>
	<td class="name" nowrap><a href="#HowToActivateBabelfish">HowToActivateBabelfish</a></td>
	<td class="summary">Babelfish must be activated before use by calling the global function
 <code>erlib_enable_plugin</code> in <strong>settings.lua</strong>.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#SearchType">SearchType</a></td>
	<td class="summary">What to search.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#Sprites">Sprites</a></td>
	<td class="summary">Babelfish built-in sprites.</td>
	</tr>
</table>
<h2><a href="#Commands">Commands </a></h2>
<table class="function_list">
	<tr>
	<td class="name" nowrap><a href="#update">update</a></td>
	<td class="summary"><code>/babelfish update</code> Updates Singleplayer language when detection failed.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#reset">reset</a></td>
	<td class="summary"><code>/babelfish reset</code> Deletes all translations and starts from scratch.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#demo">demo</a></td>
	<td class="summary"><code>/babelfish demo</code> Opens a rudimentary demonstration GUI.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#dump">dump</a></td>
	<td class="summary"><code>/babelfish dump</code> Prints internal statistics to the attached terminal.</td>
	</tr>
</table>
<h2><a href="#Events">Events </a></h2>
<table class="function_list">
	<tr>
	<td class="name" nowrap><a href="#on_babelfish_translation_state_changed">on_babelfish_translation_state_changed</a></td>
	<td class="summary">Called when SearchType translation status changes.</td>
	</tr>
</table>
<h2><a href="#Remote_Interface">Remote Interface </a></h2>
<table class="function_list">
	<tr>
	<td class="name" nowrap><a href="#RemoteInterfaceName">RemoteInterfaceName</a></td>
	<td class="summary">The remote interface is named <code>&quot;babelfish</code>".</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#can_translate">can_translate(pindex, types)</a></td>
	<td class="summary">Reports if all of the given types are completely translated yet.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#find_prototype_names">find_prototype_names(pindex, types, word, options)</a></td>
	<td class="summary">Given a user input, finds prototype names.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#translate_prototype_name">translate_prototype_name(pindex, type, name)</a></td>
	<td class="summary">Retrieves the localised name or description of a single prototype.</td>
	</tr>
</table>

<br/>
<br/>


    <h2 class="section-header "><a name="Concepts"></a>Concepts</h2>

    <dl class="function">
    <dt>
    <a name = "HowToActivateBabelfish"></a>
    <strong>HowToActivateBabelfish</strong>
    </dt>
    <dd>

<p>Babelfish must be activated before use by calling the global function
 <code>erlib_enable_plugin</code> in <strong>settings.lua</strong>.
 You must also activate at <strong>at least one</strong> <a href="../modules/Babelfish.html#SearchType">SearchType</a>
 by passing an array of search types (see the code box below for the syntax).
 Once a search type has been activated by any mod it can not be deactivated
 again. You can call <code>erlib_enable_plugin</code> repeatedly to add more search
 types later.</p>

<pre><code>erlib_enable_plugin('babelfish', {
  search_types = {'item_name', 'fluid_name', 'recipe_name'}
  })
</code></pre>

<p> The Demo-Gui must be activated seperately. It should only be activated
 during development.</p>

<pre><code>erlib_enable_plugin('babelfish-demo')
</code></pre>










</dd>
    <dt>
    <a name = "SearchType"></a>
    <strong>SearchType</strong>
    </dt>
    <dd>

<p>What to search.  One of the following strings. <strong>This is also the priority
 order in which translation occurs.</strong>  </p>

<p> For use with <a href="../modules/Babelfish.html#translate_prototype_name">Babelfish.translate_prototype_name</a> you can also activate
 each <code>_description</code> type. However as most prototypes do not have
 a description this is discouraged.</p>

<p> To minimize save, load and translation times you should only activate
 the bare minimum types you need.  </p>

<pre><code>"item_name"
"fluid_name"
"recipe_name"
"technology_name"
"equipment_name"
"tile_name"
"entity_name"
"virtual_signal_name"
</code></pre>










</dd>
    <dt>
    <a name = "Sprites"></a>
    <strong>Sprites</strong>
    </dt>
    <dd>

<p>Babelfish built-in sprites.  Can be used to decorate mod guis.
 All icons are 256x256 pixels with 4 mip-map levels.   </p>

<p> <a href="../api/Concepts.html#SpritePath">SpritePaths</a>:</p>

<pre><code> "er:babelfish-icon-default"
 "er:babelfish-icon-green"
 "er:babelfish-icon-red"
</code></pre>









    <h3>Usage:</h3>
    <ul>
        <pre class="example">LuaGuiElement.add{<span class="global">type</span> = <span class="string">"sprite-button"</span>, sprite = <span class="string">"er:babelfish-icon-default"</span>}
</pre>
    </ul>

</dd>
</dl>
    <h2 class="section-header "><a name="Commands"></a>Commands </h2>

    <dl class="function">
    <dt>
    <a name = "update"></a>
    <strong>update</strong>
    </dt>
    <dd>
    <code>/babelfish update</code> Updates Singleplayer language when detection failed.







</dd>
    <dt>
    <a name = "reset"></a>
    <strong>reset</strong>
    </dt>
    <dd>
    <code>/babelfish reset</code> Deletes all translations and starts from scratch.
 Use only when everything else failed.







</dd>
    <dt>
    <a name = "demo"></a>
    <strong>demo</strong>
    </dt>
    <dd>
    <code>/babelfish demo</code> Opens a rudimentary demonstration GUI.  Just type
 in the upper box to start searching. The gui is not optimized so the
 generation of the result icons is a bit slow for large modpacks.
 The search may also appear slow if many SearchTypes are activated
 because it searches them all at once.
 The sidepanel dynamically shows in red/green which SearchTypes
 are currently fully translated.</p>

<p> See also: <a href="../modules/Babelfish.html#HowToActivateBabelfish">HowToActivateBabelfish</a>.







</dd>
    <dt>
    <a name = "dump"></a>
    <strong>dump</strong>
    </dt>
    <dd>
    <code>/babelfish dump</code> Prints internal statistics to the attached terminal.
 This is meant for library authors and is not useful to players or mod authors.







</dd>
</dl>
    <h2 class="section-header has-description"><a name="Events"></a>Events </h2>

          <div class="section-description">

          </div>
    <dl class="function">
    <dt>
    <a name = "on_babelfish_translation_state_changed"></a>
    <strong>on_babelfish_translation_state_changed</strong>
    </dt>
    <dd>
    Called when SearchType translation status changes. </p>

<p> Mods that want to dynamically adjust their gui or similar must
 call <a href="../modules/Babelfish.html#can_translate">can_translate</a> during this event to
 get the new state. Other mods can safely ignore this event.
 Use <a href="../modules/remotes.html#events">remotes.events</a> or <a href="../modules/EventManagerLite.html#events">EventManagerLite.events</a> to get
 the event id.</p>

<p> See also: <a href="../api/Data-Lifecycle.html#">Data-Lifecycle &quot;4. control init&quot;</a>.


    <h3>Fields:</h3>
    <ul>
        <li><span class="parameter">player_index</span>
            <span class="types"><a class="type" href="../modules/Types.html#NaturalNumber">NaturalNumber</a></span>



        </li>
    </ul>





</dd>
</dl>
    <h2 class="section-header has-description"><a name="Remote_Interface"></a>Remote Interface </h2>

          <div class="section-description">

          </div>
    <dl class="function">
    <dt>
    <a name = "RemoteInterfaceName"></a>
    <strong>RemoteInterfaceName</strong>
    </dt>
    <dd>
    The remote interface is named <code>&quot;babelfish</code>".







</dd>
    <dt>
    <a name = "can_translate"></a>
    <strong>can_translate(pindex, types)</strong>
    </dt>
    <dd>
    Reports if all of the given types are completely translated yet. </p>

<p> Uses the same parameters and does the same internal checks as
 <a href="../modules/Babelfish.html#find_prototype_names">Babelfish.find_prototype_names</a> but does not conduct a search,
 and only returns the status code.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">pindex</span>



        </li>
        <li><span class="parameter">types</span>



        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

           <span class="types"><a class="type" href="../api/Builtin-Types.html#boolean">boolean</a> or <a class="type" href="https://www.lua.org/pil/2.1.html">nil</a></span>
        The status code.
    </ol>




</dd>
    <dt>
    <a name = "find_prototype_names"></a>
    <strong>find_prototype_names(pindex, types, word, options)</strong>
    </dt>
    <dd>

<p>Given a user input, finds prototype names. </p>

<p> <strong>Search Behavior:</strong></p>

<p> All searches are conducted in <strong>lower-case</strong> (as far as <a href="../lua-5.2/doc/manual.html#pdf-string.lower">string.lower</a>
 works in that language). In the SearchType order given,
 and in prototype <code>order</code> specific order.</p>

<p> As in vanilla, searching is done only on names, not descriptions. And
 unlocalised names will be found as "Unknown Key:". But there are some
 sublte intentional differences to vanilla behavior:</p>

<ol>
    <li>If <code>word</code> is an exact prototype name (i.e. "iron-plate")
    that name will <em>additionally</em> be included in the search result.  </li>
    <li>Babelfish does not filter prototypes. The search result includes names
    of all matching prototypes including hidden items, void recipes, explosion entities
    and other garbage.</li>
    <li>Babelfish understands some unicode whitespace (vanilla does <em>not</em>).</li>
</ol>

<p> <strong>Mod Settings:</strong></p>

<p> Some aspects of the search, such as "fuzzy" mode are controlled directly
 by each user via mod-settings so you don't have to worry about those.</p>

<p> <strong>Performance Tips:</strong></p>

<ol>
    <li><p>Babelfish searches are highly optimized, but in large modpacks they can
    still take a few milliseconds. When called directly from an <code>on_gui_text_changed</code>
    event handler this can cause noticible lag-spikes due to the high frequency
    with which that even occurs while a player is typing. A better solution is
    to impose a delay after the last keypress or to use an <code>on_tick</code> based
    polling solution. It is recommended to search only once per second.</p></li>
    <li><p>Babelfish does not impose a minimum word length. The <a href="../modules/Types.html#EmptyString">EmptyString</a> will
    match everything. It is recommended to impose a minimum length of
    two characters on <code>word</code>, or use the <code>limit</code> option to reduce the size
    of the returned table.</p></li>
</ol>





    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">pindex</span>
            <span class="types"><a class="type" href="../modules/Types.html#NaturalNumber">NaturalNumber</a></span>
         A <a href="../api/LuaPlayer.html#LuaPlayer.index">LuaPlayer.index</a>.
        </li>
        <li><span class="parameter">types</span>
            <span class="types"><a class="type" href="../lua-5.2/doc/manual.html#pdf-string">string</a> or <a class="type" href="../modules/Types.html#DenseArray">DenseArray</a></span>
         One or more <a href="../modules/Babelfish.html#SearchType">SearchTypes</a>.
        </li>
        <li><span class="parameter">word</span>
            <span class="types"><a class="type" href="../lua-5.2/doc/manual.html#pdf-string">string</a></span>
         The user input.
        </li>
        <li><span class="parameter">options</span> (<a href="../lua-5.2/doc/manual.html#pdf-table">table</a>)
        <ul>
        <li><span class="parameter">limit</span>
            <span class="types"><a class="type" href="../modules/Types.html#Integer">Integer</a></span>
         Search will return at most this
 many names. This may result in some of the returned sub-tables being empty.
         (<em>default</em> inf)
        </li>
        </li></ul>
    </ul>

    <h3>Returns:</h3>
    <ol>
        <li>
           <span class="types"><a class="type" href="../api/Builtin-Types.html#boolean">boolean</a> or <a class="type" href="https://www.lua.org/pil/2.1.html">nil</a></span>
         The status code.  </p>

<p>   <a href="https://www.lua.org/pil/2.1.html">nil</a> means: The language for that player has not been detected yet.
   This will hardly ever happen in reality. Just try again a second later.
   <strong>The search result is also nil.</strong></p>

<p>   <a href="../modules/Types.html#false">false</a> means: Babelfish is still translating some or all of the requested
   SearchTypes. An incomplete best-effort search result is returned.
   You can use that partial result or try again later. If you chose to
   inform the player you can use the <a href="../api/Concepts.html#LocalisedString">LocalisedString</a>
   <code>{&apos;babelfish.translation-in-progress&apos;}</code> or a custom message.</p>

<p>   <a href="../modules/Types.html#true">true</a> means: No problems occured.  </li>
        <li>
           <span class="types"><a class="type" href="../lua-5.2/doc/manual.html#pdf-table">table</a> or <a class="type" href="https://www.lua.org/pil/2.1.html">nil</a></span>
         The search result. A table mapping each requested
 SearchType to a <a href="../modules/Types.html#set">set</a> of prototype names. </li>
    </ol>



    <h3>Usage:</h3>
    <ul>
        <pre class="example"><span class="comment">-- First lets make a shortcut.
</span><span class="keyword">local</span> babelfind = (<span class="keyword">function</span>(c) <span class="keyword">return</span> <span class="keyword">function</span>(...)
  <span class="keyword">return</span> c(<span class="string">'babelfish'</span>, <span class="string">'find_prototype_names'</span>, ...)
  <span class="keyword">end</span> <span class="keyword">end</span>)(remote.call)

<span class="comment">-- For demonstration purposes let's use a player with a German locale.
</span><span class="keyword">local</span> ok, results
  = babelfind(game.player.index, {<span class="string">'item_name'</span>, <span class="string">'recipe_name'</span>}, <span class="string">'Kupfer'</span>)
<span class="keyword">if</span> ok <span class="keyword">then</span>
  <span class="global">print</span>(serpent.block(results))
  <span class="keyword">end</span>

&gt; {
&gt;   item_name = {
&gt;     [<span class="string">"copper-cable"</span>] = <span class="keyword">true</span>,
&gt;     [<span class="string">"copper-ore"</span>  ] = <span class="keyword">true</span>,
&gt;     [<span class="string">"copper-plate"</span>] = <span class="keyword">true</span>
&gt;   },
&gt;   recipe_name = {
&gt;     [<span class="string">"copper-cable"</span>] = <span class="keyword">true</span>,
&gt;     [<span class="string">"copper-plate"</span>] = <span class="keyword">true</span>
&gt;   }
&gt; }
</pre>
    </ul>

</dd>
    <dt>
    <a name = "translate_prototype_name"></a>
    <strong>translate_prototype_name(pindex, type, name)</strong>
    </dt>
    <dd>
    Retrieves the localised name or description of a single prototype.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">pindex</span>
            <span class="types"><a class="type" href="../modules/Types.html#NaturalNumber">NaturalNumber</a></span>
         A <a href="../api/LuaPlayer.html#LuaPlayer.index">LuaPlayer.index</a>.
        </li>
        <li><span class="parameter">type</span>
            <span class="types"><a class="type" href="../lua-5.2/doc/manual.html#pdf-string">string</a></span>
         A <a href="../modules/Babelfish.html#SearchType">SearchType</a>.
        </li>
        <li><span class="parameter">name</span>
            <span class="types"><a class="type" href="../lua-5.2/doc/manual.html#pdf-string">string</a></span>
         A prototype name.
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

           <span class="types"><a class="type" href="../lua-5.2/doc/manual.html#pdf-string">string</a> or <a class="type" href="https://www.lua.org/pil/2.1.html">nil</a></span>
         The translation, or nil if that entry is
 not translated yet. Unlocalised descriptions
 will return an empty string. Unlocalised names return the usual "Unknown key:".
 <strong>The result should be used immediately</strong> or it may become outdated.
    </ol>




</dd>
</dl>


</div> <!-- id="content" -->
</div> <!-- id="main" -->
<div id="about">
<i>generated by <a href="http://github.com/stevedonovan/LDoc">LDoc 1.4.6</a></i>
<i style="float:right;">Last updated 2021-09-01 19:56:37 </i>
</div> <!-- id="about" -->
</div> <!-- id="container" -->
</body>
</html>
