<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
   "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<head>
    <title>Erlib Documentation</title>
    <link rel="stylesheet" href="../ldoc.css" type="text/css" />
</head>
<body>

<div id="container">

<div id="product">
	<div id="product_logo"></div>
	<div id="product_name"><big><b></b></big></div>
	<div id="product_description"></div>
</div> <!-- id="product" -->


<div id="main">


<!-- Menu -->

<div id="navigation">
<br/>
<h1>ldoc</h1>

<ul>
  <li><a href="../index.html">Index</a></li>
</ul>

<h2>Contents</h2>
<ul>
<li><a href="#Startup">Startup </a></li>
<li><a href="#Remote_Interface_Types">Remote Interface Types </a></li>
<li><a href="#Remote_Interface">Remote Interface </a></li>
</ul>


<h2>Modules</h2>
<ul class="nowrap">
  <li><a href="../modules/Core.html">Core</a></li>
  <li><a href="../modules/Types.html">Types</a></li>
  <li><a href="../modules/Concepts.html">Concepts</a></li>
  <li><a href="../modules/Cache.html">Cache</a></li>
  <li><a href="../modules/Data.html">Data</a></li>
  <li><a href="../modules/Template.html">Template</a></li>
  <li><a href="../modules/Entity.html">Entity</a></li>
  <li><a href="../modules/EventManager.html">EventManager</a></li>
  <li><a href="../modules/EventManagerLite.html">EventManagerLite</a></li>
  <li><a href="../modules/Force.html">Force</a></li>
  <li><a href="../modules/Gui.html">Gui</a></li>
  <li><a href="../modules/Locale.html">Locale</a></li>
  <li><a href="../modules/Player.html">Player</a></li>
  <li><a href="../modules/PluginManager.html">PluginManager</a></li>
  <li><a href="../modules/PluginManagerLite.html">PluginManagerLite</a></li>
  <li><a href="../modules/Remote.html">Remote</a></li>
  <li><a href="../modules/Setting.html">Setting</a></li>
  <li><a href="../modules/Stacktrace.html">Stacktrace</a></li>
  <li><a href="../modules/Train.html">Train</a></li>
  <li><a href="../modules/Array.html">Array</a></li>
  <li><a href="../modules/Class.html">Class</a></li>
  <li><a href="../modules/Coding.html">Coding</a></li>
  <li><a href="../modules/Color.html">Color</a></li>
  <li><a href="../modules/Compare.html">Compare</a></li>
  <li><a href="../modules/Debug.html">Debug</a></li>
  <li><a href="../modules/Error.html">Error</a></li>
  <li><a href="../modules/Filter.html">Filter</a></li>
  <li><a href="../modules/Iter.html">Iter</a></li>
  <li><a href="../modules/Lambda.html">Lambda</a></li>
  <li><a href="../modules/LocalisedString.html">LocalisedString</a></li>
  <li><a href="../modules/Lock.html">Lock</a></li>
  <li><a href="../modules/Log.html">Log</a></li>
  <li><a href="../modules/Logic.html">Logic</a></li>
  <li><a href="../modules/Math.html">Math</a></li>
  <li><a href="../modules/Meta.html">Meta</a></li>
  <li><a href="../modules/Polygon.html">Polygon</a></li>
  <li><a href="../modules/Replicate.html">Replicate</a></li>
  <li><a href="../modules/Set.html">Set</a></li>
  <li><a href="../modules/String.html">String</a></li>
  <li><a href="../modules/Table.html">Table</a></li>
  <li><a href="../modules/Time.html">Time</a></li>
  <li><a href="../modules/Tool.html">Tool</a></li>
  <li><a href="../modules/Vector.html">Vector</a></li>
  <li><a href="../modules/Verificate.html">Verificate</a></li>
  <li><a href="../modules/Version.html">Version</a></li>
  <li><a href="../modules/remotes.html">remotes</a></li>
  <li><a href="../modules/snippet.html">snippet</a></li>
  <li><strong>Babelfish</strong></li>
</ul>
<h2>Source</h2>
<ul class="nowrap">
  <li><a href="../source/Introduction.html">Introduction</a></li>
</ul>

</div>

<div id="content">

<h1>Module <code>Babelfish</code></h1>
<p>Localised string search for mods.</p>
<p> Babelfish is a caching translator for standard prototype localisations.
 When it detects changes in the locale it starts a background task to
 translate all prototype names and descriptions. While this task is running
 a small status indicator in the upper right corner informs each user of
 the current progress. Each language only needs to be translated once,
 making the process instantaneous to most users even in multiplayer.</p>

<p> At the default network speed setting it takes about 10 seconds to fully
 translate one language in vanilla factorio.</p>

<p> <a href="../source/Introduction.html#DevelopmentStatus">Module Status</a>: Work in progress.</p>
    <h3>Usage:</h3>
    <ul>
        <pre class="example">-- settings.lua
erlib_enable_plugin(&apos;babelfish&apos;)
erlib_configure_plugin(&apos;babelfish&apos;, {
  search_types = {&apos;item_name&apos;, &apos;recipe_name&apos;}
  })

-- control.lua
remote.call(&apos;er:babelfish-remote-interface&apos;,&apos;find&apos;, player_index, word, options)
</pre>
    </ul>


<h2><a href="#Startup">Startup </a></h2>
<table class="function_list">
	<tr>
	<td class="name" nowrap><a href="#HowToActivateBabelfish">HowToActivateBabelfish</a></td>
	<td class="summary">Babelfish must be activated and configured before use by calling the
 two public global functions explained in the example.</td>
	</tr>
</table>
<h2><a href="#Remote_Interface_Types">Remote Interface Types </a></h2>
<table class="function_list">
	<tr>
	<td class="name" nowrap><a href="#SearchType">SearchType</a></td>
	<td class="summary">What to search.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#LanguageCode">LanguageCode</a></td>
	<td class="summary">Identifies a language between different Babelfish function calls.</td>
	</tr>
</table>
<h2><a href="#Remote_Interface">Remote Interface </a></h2>
<table class="function_list">
	<tr>
	<td class="name" nowrap><a href="#can_find">can_find(pindex, types)</a></td>
	<td class="summary">Reports if the given types are completely translated yet.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#find_prototype_names">find_prototype_names(pindex, types, word, options)</a></td>
	<td class="summary">Given a user input, finds prototype names.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#get_player_language_code">get_player_language_code(pindex)</a></td>
	<td class="summary">Retrieves the language code of a player.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#get_translation_percentages">get_translation_percentages()</a></td>
	<td class="summary">Retrieves translation percentage of all seen languages.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#force_update">force_update([reset=false])</a></td>
	<td class="summary">Triggers an internal update.</td>
	</tr>
</table>

<br/>
<br/>


    <h2 class="section-header has-description"><a name="Startup"></a>Startup </h2>

          <div class="section-description">

          </div>
    <dl class="function">
    <dt>
    <a name = "HowToActivateBabelfish"></a>
    <strong>HowToActivateBabelfish</strong>
    </dt>
    <dd>
    Babelfish must be activated and configured before use by calling the
 two public global functions explained in the example.  Otherwise it
 will not load at all. This configuration is global for all mods.
 This must be done in <strong>settings.lua</strong>.</p>

<p> You must first activate Babelfish and then add at least one
 <a href="../modules/Babelfish.html#SearchType">SearchType</a>.






    <h3>Usage:</h3>
    <ul>
        <pre class="example">erlib_enable_plugin(<span class="string">'babelfish'</span>)

<span class="comment">--This *ADDS* several types. Types can not be removed once added by any mod.
</span>erlib_configure_plugin(<span class="string">'babelfish'</span>, {
  search_types = {<span class="string">'item_name'</span>, <span class="string">'recipe_name'</span>}
  })
</pre>
    </ul>

</dd>
</dl>
    <h2 class="section-header "><a name="Remote_Interface_Types"></a>Remote Interface Types </h2>

    <dl class="function">
    <dt>
    <a name = "SearchType"></a>
    <strong>SearchType</strong>
    </dt>
    <dd>

<p>What to search.  One of the following strings. This is also the
 order in which translation occurs.</p>

<pre><code>'recipe_name'    , 'recipe_description'
'item_name'      , 'item_description'
'fluid_name'     , 'fluid_description'
'entity_name'    , 'entity_description'
'technology_name', 'technology_description'
'equipment_name' , 'equipment_description'
'tile_name'      , 'tile_description'
</code></pre>










</dd>
    <dt>
    <a name = "LanguageCode"></a>
    <strong>LanguageCode</strong>
    </dt>
    <dd>
    Identifies a language between different Babelfish function calls.
 Storing this in your global data will likely produce unexpected results.
 It's best to always retrieve this shortly before usage.







</dd>
</dl>
    <h2 class="section-header has-description"><a name="Remote_Interface"></a>Remote Interface </h2>

          <div class="section-description">

          </div>
    <dl class="function">
    <dt>
    <a name = "can_find"></a>
    <strong>can_find(pindex, types)</strong>
    </dt>
    <dd>
    Reports if the given types are completely translated yet. </p>

<p> Does the same internal checks as <a href="../modules/Babelfish.html#find_prototype_names">Babelfish.find_prototype_names</a> so
 usually you won't need to call this seperately.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">pindex</span>
            <span class="types"><span class="type">player_index</span> or <span class="type">LanguageCode</span></span>
         A language code should only be used if your mod needs to
 allow a player to search in a locale different from their own.
        </li>
        <li><span class="parameter">types</span>
            <span class="types"><a class="type" href="../lua-5.2/doc/manual.html#pdf-string">string</a> or <a class="type" href="../modules/Types.html#DenseArray">DenseArray</a></span>
         One or more <a href="../modules/Babelfish.html#SearchType">SearchTypes</a>.
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

           <span class="types"><a class="type" href="../api/Builtin-Types.html#boolean">boolean</a></span>
        If all of the given types are searchable.
    </ol>




</dd>
    <dt>
    <a name = "find_prototype_names"></a>
    <strong>find_prototype_names(pindex, types, word, options)</strong>
    </dt>
    <dd>
    Given a user input, finds prototype names.
 Can search the localised name and description of all common prototypes
 to deliver a native search experience.</p>

<p> Translation is granular per <a href="../modules/Babelfish.html#SearchType">SearchType</a>,
 so users can start searching for i.e. recipe names even if item names
 are still being translated.</p>

<p> Prototypes with unlocalised strings (i.e. "unknown-key:*")
 are not included in the search.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">pindex</span>
            <span class="types"><span class="type">player_index</span> or <span class="type">LanguageCode</span></span>
         A language code should only be used if your mod needs to
 allow a player to search in a locale different from their own.
        </li>
        <li><span class="parameter">types</span>
            <span class="types"><a class="type" href="../lua-5.2/doc/manual.html#pdf-string">string</a> or <a class="type" href="../modules/Types.html#DenseArray">DenseArray</a></span>
         One or more <a href="../modules/Babelfish.html#SearchType">SearchTypes</a>.
        </li>
        <li><span class="parameter">word</span>
            <span class="types"><a class="type" href="../lua-5.2/doc/manual.html#pdf-string">string</a></span>
         The user input.
        </li>
        <li><span class="parameter">options</span> (<a href="../lua-5.2/doc/manual.html#pdf-table">table</a>)
        <ul>
        <li><span class="parameter">limit</span>
            <span class="types"><a class="type" href="../modules/Types.html#Integer">Integer</a></span>
         Search will abort after this many
 hits and return the (partial) result.
         (<em>default</em> inf)
        </li>
        <li><span class="parameter">mode</span>
            <span class="types"><a class="type" href="../lua-5.2/doc/manual.html#pdf-string">string</a></span>
         <code>&apos;plain&apos;</code>, <code>&apos;fuzzy&apos;</code> or <code>&apos;lua&apos;</code>.
 Plain and fuzzy modes should work fine with unicode input.
 Lua mode will return an empty search result if "word" is not
 a <a href="../lua-5.2/doc/manual.html#pdf-string.find">string.find</a> compatible pattern.
         (<em>default</em> plain)
        </li>
        </li></ul>
    </ul>

    <h3>Returns:</h3>
    <ol>
        <li>
           <span class="types"><a class="type" href="../api/Builtin-Types.html#boolean">boolean</a> or <a class="type" href="https://www.lua.org/pil/2.1.html">nil</a></span>
          </p>

<p>   <a href="https://www.lua.org/pil/2.1.html">nil</a> means: The requested language is not available. Either you used
   an outdated LanguageCode or the player has only just connected and isn't
   identified yet. No search result is returned.  </p>

<p>   <a href="../modules/Types.html#false">false</a> means: Babelfish is still translating some or all of the requested
   SearchTypes. A best effort search result is included but likely to be
   incomplete. It is recommended to try again after translation is complete.  </p>

<p>   <a href="../modules/Types.html#true">true</a> means: No problems occured.  </li>
        <li>
           <span class="types"><a class="type" href="../lua-5.2/doc/manual.html#pdf-table">table</a> or <a class="type" href="https://www.lua.org/pil/2.1.html">nil</a></span>
         The search result. A table mapping each requested
 SearchType to a <a href="../modules/Types.html#set">set</a> of prototype names. </li>
    </ol>



    <h3>Usage:</h3>
    <ul>
        <pre class="example"><span class="comment">-- First lets make a shortcut.
</span><span class="keyword">local</span> babelfind = (<span class="keyword">function</span>(c) <span class="keyword">return</span> <span class="keyword">function</span>(...)
  <span class="keyword">return</span> c(<span class="string">'er:babelfish-remote-interface'</span>,<span class="string">'find_prototype_names'</span>,...)
  <span class="keyword">end</span> <span class="keyword">end</span>)(remote.call)

<span class="comment">-- Now lets try something. For demonstration purposes I'm using a player
</span><span class="comment">-- with a German locale.
</span><span class="keyword">local</span> ok, results
  = babelfind(game.player.index, {<span class="string">'item_name'</span>,<span class="string">'recipe_name'</span>},<span class="string">'Kupfer'</span>)
<span class="keyword">if</span> ok <span class="keyword">then</span> <span class="global">print</span>(serpent.block(results)) <span class="keyword">end</span>

&gt; {
&gt;   item_name = {
&gt;     [<span class="string">"copper-cable"</span>] = <span class="keyword">true</span>,
&gt;     [<span class="string">"copper-ore"</span>] = <span class="keyword">true</span>,
&gt;     [<span class="string">"copper-plate"</span>] = <span class="keyword">true</span>
&gt;   },
&gt;   recipe_name = {
&gt;     [<span class="string">"copper-cable"</span>] = <span class="keyword">true</span>,
&gt;     [<span class="string">"copper-plate"</span>] = <span class="keyword">true</span>
&gt;   }
&gt; }
</pre>
    </ul>

</dd>
    <dt>
    <a name = "get_player_language_code"></a>
    <strong>get_player_language_code(pindex)</strong>
    </dt>
    <dd>
    Retrieves the language code of a player.
 Only <a href="../api/LuaPlayer.html#LuaPlayer.connected">connected</a> players have a code, and
 there is a delay of one "ping" between connection and code
 assignment.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">pindex</span>
            <span class="types"><a class="type" href="../modules/Types.html#NaturalNumber">NaturalNumber</a></span>
         A <a href="../api/LuaPlayer.html#LuaPlayer.index">LuaPlayer.index</a>.
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

        The <a href="../modules/Babelfish.html#LanguageCode">LanguageCode</a> or <a href="https://www.lua.org/pil/2.1.html">nil</a>.
    </ol>




</dd>
    <dt>
    <a name = "get_translation_percentages"></a>
    <strong>get_translation_percentages()</strong>
    </dt>
    <dd>
    Retrieves translation percentage of all seen languages.
 This is the same data that the built-in status indicator uses.
 Includes only languages that have been seen on this map at least once.</p>

<p> <strong>Note:</strong> This is the total percentage. Prioritized SearchType are
 usually available much earlier than 100%. Use <a href="../modules/Babelfish.html#can_find">Babelfish.can_find</a>.



    <h3>Returns:</h3>
    <ol>

           <span class="types"><a class="type" href="../lua-5.2/doc/manual.html#pdf-table">table</a></span>
         A mapping (<a href="../modules/Babelfish.html#LanguageCode">LanguageCode</a> → <a href="../modules/Types.html#NaturalNumber">NaturalNumber</a>)
 where the number is between 0 and 100 inclusive.
    </ol>




</dd>
    <dt>
    <a name = "force_update"></a>
    <strong>force_update([reset=false])</strong>
    </dt>
    <dd>
    Triggers an internal update. </p>

<p> This is meant to be used to circumvent the hard engine limitation of
 no events being raised in Singleplayer when the locale changes but
 nothing else changed.</p>

<p> This can also be triggered by the commands <code>&apos;/babelfish update&apos;</code> (sp only)
 and <code>&apos;/babelfish reset&apos;</code> (admin only) respectively.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">reset</span>
            <span class="types"><a class="type" href="../api/Builtin-Types.html#boolean">boolean</a></span>
         Completely resets all translations
 instead of just performing a normal update.
         (<em>default</em> false)
        </li>
    </ul>





</dd>
</dl>


</div> <!-- id="content" -->
</div> <!-- id="main" -->
<div id="about">
<i>generated by <a href="http://github.com/stevedonovan/LDoc">LDoc 1.4.6</a></i>
<i style="float:right;">Last updated 2021-06-03 00:30:23 </i>
</div> <!-- id="about" -->
</div> <!-- id="container" -->
</body>
</html>
