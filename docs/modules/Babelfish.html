<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
   "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<head>
    <title>Erlib Documentation</title>
    <link rel="stylesheet" href="../ldoc.css" type="text/css" />
</head>
<body>

<div id="container">

<div id="product">
	<div id="product_logo"></div>
	<div id="product_name"><big><b></b></big></div>
	<div id="product_description"></div>
</div> <!-- id="product" -->


<div id="main">


<!-- Menu -->

<div id="navigation">
<br/>
<h1>ldoc</h1>

<ul>
  <li><a href="../index.html">Index</a></li>
</ul>

<h2>Contents</h2>
<ul>
<li><a href="#Startup">Startup </a></li>
<li><a href="#Remote_Interface_Types">Remote Interface Types </a></li>
<li><a href="#Remote_Interface">Remote Interface </a></li>
<li><a href="#Commands">Commands </a></li>
</ul>


<h2>Modules</h2>
<ul class="nowrap">
  <li><a href="../modules/Core.html">Core</a></li>
  <li><a href="../modules/Types.html">Types</a></li>
  <li><a href="../modules/Concepts.html">Concepts</a></li>
  <li><a href="../modules/Cache.html">Cache</a></li>
  <li><a href="../modules/Data.html">Data</a></li>
  <li><a href="../modules/Template.html">Template</a></li>
  <li><a href="../modules/Entity.html">Entity</a></li>
  <li><a href="../modules/EventManager.html">EventManager</a></li>
  <li><a href="../modules/EventManagerLite.html">EventManagerLite</a></li>
  <li><a href="../modules/Force.html">Force</a></li>
  <li><a href="../modules/Gui.html">Gui</a></li>
  <li><a href="../modules/Locale.html">Locale</a></li>
  <li><a href="../modules/Player.html">Player</a></li>
  <li><a href="../modules/PluginManagerLite.html">PluginManagerLite</a></li>
  <li><a href="../modules/Remote.html">Remote</a></li>
  <li><a href="../modules/Setting.html">Setting</a></li>
  <li><a href="../modules/Stacktrace.html">Stacktrace</a></li>
  <li><a href="../modules/Train.html">Train</a></li>
  <li><a href="../modules/Wube.html">Wube</a></li>
  <li><a href="../modules/Array.html">Array</a></li>
  <li><a href="../modules/Class.html">Class</a></li>
  <li><a href="../modules/Coding.html">Coding</a></li>
  <li><a href="../modules/Color.html">Color</a></li>
  <li><a href="../modules/Compare.html">Compare</a></li>
  <li><a href="../modules/Debug.html">Debug</a></li>
  <li><a href="../modules/Error.html">Error</a></li>
  <li><a href="../modules/Filter.html">Filter</a></li>
  <li><a href="../modules/Iter.html">Iter</a></li>
  <li><a href="../modules/Lambda.html">Lambda</a></li>
  <li><a href="../modules/LocalisedString.html">LocalisedString</a></li>
  <li><a href="../modules/Lock.html">Lock</a></li>
  <li><a href="../modules/Log.html">Log</a></li>
  <li><a href="../modules/Logic.html">Logic</a></li>
  <li><a href="../modules/Math.html">Math</a></li>
  <li><a href="../modules/Meta.html">Meta</a></li>
  <li><a href="../modules/Polygon.html">Polygon</a></li>
  <li><a href="../modules/Replicate.html">Replicate</a></li>
  <li><a href="../modules/Set.html">Set</a></li>
  <li><a href="../modules/String.html">String</a></li>
  <li><a href="../modules/Table.html">Table</a></li>
  <li><a href="../modules/Time.html">Time</a></li>
  <li><a href="../modules/Tool.html">Tool</a></li>
  <li><a href="../modules/Vector.html">Vector</a></li>
  <li><a href="../modules/Verificate.html">Verificate</a></li>
  <li><a href="../modules/Version.html">Version</a></li>
  <li><a href="../modules/remotes.html">remotes</a></li>
  <li><a href="../modules/snippet.html">snippet</a></li>
  <li><strong>Babelfish</strong></li>
</ul>
<h2>Source</h2>
<ul class="nowrap">
  <li><a href="../source/Introduction.html">Introduction</a></li>
</ul>

</div>

<div id="content">

<h1>Module <code>Babelfish</code></h1>
<p>Localised string search for mods.</p>
<p> Babelfish is a caching translator for standard prototype localisations.
 When it detects changes in the locale it starts a background task to
 translate all prototype names and descriptions. In Singleplayer this
 process happens during the loading screen and is invisible to the player.
 In Multiplayer translation is done gradually in in on_tick to prevent
 network congestion. While this task is running
 a small status indicator in the upper right corner informs each user of
 the current progress. Each language only needs to be translated once,
 so even in Multiplayer the process is instant for most users.</p>

<p> At the default network speed setting on a vanilla factorio installation:
 It takes ~20 ticks to fully translate all item and fluid names of one language.
 And it takes ~6 seconds to fully translate all names and descriptions of one language.</p>

<p> <a href="../source/Introduction.html#DevelopmentStatus">Module Status</a>: Polishing.</p>


<h2><a href="#Startup">Startup </a></h2>
<table class="function_list">
	<tr>
	<td class="name" nowrap><a href="#HowToActivateBabelfish">HowToActivateBabelfish</a></td>
	<td class="summary">Babelfish must be activated and configured before use by calling <em>both</em>
 public global functions explained in the example.</td>
	</tr>
</table>
<h2><a href="#Remote_Interface_Types">Remote Interface Types </a></h2>
<table class="function_list">
	<tr>
	<td class="name" nowrap><a href="#SearchType">SearchType</a></td>
	<td class="summary">What to search.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#LanguageCode">LanguageCode</a></td>
	<td class="summary">Identifies a language between different Babelfish function calls.</td>
	</tr>
</table>
<h2><a href="#Remote_Interface">Remote Interface </a></h2>
<table class="function_list">
	<tr>
	<td class="name" nowrap><a href="#find_prototype_names">find_prototype_names(pindex, types, word, options)</a></td>
	<td class="summary">Given a user input, finds prototype names.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#can_find">can_find(pindex, types, options)</a></td>
	<td class="summary">Reports if all of the given types are completely translated yet.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#get_player_language_code">get_player_language_code(pindex)</a></td>
	<td class="summary">Retrieves the LanguageCode of a player.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#get_translation_percentages">get_translation_percentages()</a></td>
	<td class="summary">Retrieves all translation percentages.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#force_update">force_update([reset=false])</a></td>
	<td class="summary">Triggers an internal update.</td>
	</tr>
</table>
<h2><a href="#Commands">Commands </a></h2>
<table class="function_list">
	<tr>
	<td class="name" nowrap><a href="#update">update</a></td>
	<td class="summary"><code>/babelfish update</code> Updates Singleplayer language when detection failed.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#reset">reset</a></td>
	<td class="summary"><code>/babelfish reset</code> Deletes all translations and starts from scratch.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#dump">dump</a></td>
	<td class="summary"><code>/babelfish dump</code> Prints internal statistics to the attached terminal.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#demo">demo</a></td>
	<td class="summary"><code>/babelfish demo</code> Opens a rudimentary demonstration GUI.</td>
	</tr>
</table>

<br/>
<br/>


    <h2 class="section-header has-description"><a name="Startup"></a>Startup </h2>

          <div class="section-description">

          </div>
    <dl class="function">
    <dt>
    <a name = "HowToActivateBabelfish"></a>
    <strong>HowToActivateBabelfish</strong>
    </dt>
    <dd>
    Babelfish must be activated and configured before use by calling <em>both</em>
 public global functions explained in the example.  Otherwise it
 will not load at all. This configuration is global for all mods.
 This must be done in <strong>settings.lua</strong>.</p>

<p> You must first activate Babelfish and then add at least one
 <a href="../modules/Babelfish.html#SearchType">SearchType</a>.






    <h3>Usage:</h3>
    <ul>
        <pre class="example">erlib_enable_plugin(<span class="string">'babelfish'</span>)

<span class="comment">--This *ADDS* several types. Types can not be removed once added by any mod.
</span>erlib_configure_plugin(<span class="string">'babelfish'</span>, {
  search_types = {<span class="string">'item_name'</span>, <span class="string">'fluid_name'</span>, <span class="string">'recipe_name'</span>}
  })
</pre>
    </ul>

</dd>
</dl>
    <h2 class="section-header "><a name="Remote_Interface_Types"></a>Remote Interface Types </h2>

    <dl class="function">
    <dt>
    <a name = "SearchType"></a>
    <strong>SearchType</strong>
    </dt>
    <dd>

<p>What to search.  One of the following strings. This is also the
 order in which translation occurs. Once translation for a type
 is complete it can be fully searched, regardless of the translation
 status of the other types.</p>

<pre><code>'item_name'      , 'item_description'
'fluid_name'     , 'fluid_description'
'recipe_name'    , 'recipe_description'
'technology_name', 'technology_description'
'equipment_name' , 'equipment_description'
'tile_name'      , 'tile_description'
'entity_name'    , 'entity_description'
</code></pre>










</dd>
    <dt>
    <a name = "LanguageCode"></a>
    <strong>LanguageCode</strong>
    </dt>
    <dd>
    Identifies a language between different Babelfish function calls.
 Storing this in your global data will likely produce unexpected results.
 It's best to always retrieve this shortly before usage.</p>

<p> Only <a href="../api/LuaPlayer.html#LuaPlayer.connected">connected</a> players have a code, and
 there is a delay of one "ping" between connection and code
 assignment.</p>

<p> The special string <code>&apos;internal&apos;</code> can be used to ignore the locale and
 search prototype names directly.







</dd>
</dl>
    <h2 class="section-header has-description"><a name="Remote_Interface"></a>Remote Interface </h2>

          <div class="section-description">

          </div>
    <dl class="function">
    <dt>
    <a name = "find_prototype_names"></a>
    <strong>find_prototype_names(pindex, types, word, options)</strong>
    </dt>
    <dd>
    Given a user input, finds prototype names.
 Can search the localised name and description of all common prototypes
 to deliver a native search experience.
 Translation is granular per <a href="../modules/Babelfish.html#SearchType">SearchType</a>.</p>

<p> All searches are conducted in <strong>lower-case</strong> (as far as <a href="../lua-5.2/doc/manual.html#pdf-string.lower">string.lower</a>
 works in that language). In the SearchType order given,
 and in prototype <code>order</code> specific order.</p>

<p> The search result is identical to vanilla search even for unlocalised
 names and descriptions (i.e. "Unknown Key:").</p>

<p> With some intentional exceptions: <br/>
 1) If <code>word</code> is an exact prototype name (i.e. "iron-plate")
 that prototype will <em>additionally</em> be included in the search result. <br/>
 2) Babelfish does not filter prototypes. The serch result includes names
 of all matching prototypes including hidden items, void recipes, etc. <br/>
 3) Babelfish understands unicode language spaces (vanilla does <em>not</em>).


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">pindex</span>
            <span class="types"><a class="type" href="../modules/Types.html#NaturalNumber">NaturalNumber</a></span>
         A <a href="../api/LuaPlayer.html#LuaPlayer.index">LuaPlayer.index</a>.
        </li>
        <li><span class="parameter">types</span>
            <span class="types"><a class="type" href="../lua-5.2/doc/manual.html#pdf-string">string</a> or <a class="type" href="../modules/Types.html#DenseArray">DenseArray</a></span>
         One or more <a href="../modules/Babelfish.html#SearchType">SearchTypes</a>.
        </li>
        <li><span class="parameter">word</span>
            <span class="types"><a class="type" href="../lua-5.2/doc/manual.html#pdf-string">string</a></span>
         The user input. Interpreted according to the users chosen
 search mode: plaintext, fuzzy or lua pattern. (Currently
 implemented as a per-player mod setting).
        </li>
        <li><span class="parameter">options</span> (<a href="../lua-5.2/doc/manual.html#pdf-table">table</a>)
        <ul>
        <li><span class="parameter">limit</span>
            <span class="types"><a class="type" href="../modules/Types.html#Integer">Integer</a></span>
         Search will abort after this many
 hits and return the (partial) result.
         (<em>default</em> inf)
        </li>
        <li><span class="parameter">language_code</span>
            <span class="types"><span class="type">LanguageCode</span></span>
         Defaults to the players current language.
 Can be used to let a player search in the language of another player.
         (<em>optional</em>)
        </li>
        </li></ul>
    </ul>

    <h3>Returns:</h3>
    <ol>
        <li>
           <span class="types"><a class="type" href="../api/Builtin-Types.html#boolean">boolean</a> or <a class="type" href="https://www.lua.org/pil/2.1.html">nil</a></span>
         The status code.  </p>

<p>   <a href="https://www.lua.org/pil/2.1.html">nil</a> means: The requested language is not available. Either you used
   <code>options.language_code</code> with an outdated code, or the player does not
   yet have a <a href="../modules/Babelfish.html#LanguageCode">LanguageCode</a>.</p>

<p>   <a href="../modules/Types.html#false">false</a> means: Babelfish is still translating some or all of the requested
   SearchTypes. A best-effort search result is included but likely to be
   incomplete. It is recommended to try again after translation is complete.  </p>

<p>   <a href="../modules/Types.html#true">true</a> means: No problems occured.  </li>
        <li>
           <span class="types"><a class="type" href="../lua-5.2/doc/manual.html#pdf-table">table</a> or <a class="type" href="https://www.lua.org/pil/2.1.html">nil</a></span>
         The search result. A table mapping each requested
 SearchType to a <a href="../modules/Types.html#set">set</a> of prototype names. </li>
    </ol>



    <h3>Usage:</h3>
    <ul>
        <pre class="example"><span class="comment">-- First lets make a shortcut.
</span><span class="keyword">local</span> babelfind = (<span class="keyword">function</span>(c) <span class="keyword">return</span> <span class="keyword">function</span>(...)
  <span class="keyword">return</span> c(<span class="string">'babelfish'</span>, <span class="string">'find_prototype_names'</span>, ...)
  <span class="keyword">end</span> <span class="keyword">end</span>)(remote.call)

<span class="comment">-- For demonstration purposes let's use a player with a German locale.
</span><span class="keyword">local</span> ok, results
  = babelfind(game.player.index, {<span class="string">'item_name'</span>, <span class="string">'recipe_name'</span>}, <span class="string">'Kupfer'</span>)
<span class="keyword">if</span> ok <span class="keyword">then</span> <span class="global">print</span>(serpent.block(results)) <span class="keyword">end</span>

&gt; {
&gt;   item_name = {
&gt;     [<span class="string">"copper-cable"</span>] = <span class="keyword">true</span>,
&gt;     [<span class="string">"copper-ore"</span>  ] = <span class="keyword">true</span>,
&gt;     [<span class="string">"copper-plate"</span>] = <span class="keyword">true</span>
&gt;   },
&gt;   recipe_name = {
&gt;     [<span class="string">"copper-cable"</span>] = <span class="keyword">true</span>,
&gt;     [<span class="string">"copper-plate"</span>] = <span class="keyword">true</span>
&gt;   }
&gt; }
</pre>
    </ul>

</dd>
    <dt>
    <a name = "can_find"></a>
    <strong>can_find(pindex, types, options)</strong>
    </dt>
    <dd>
    Reports if all of the given types are completely translated yet. </p>

<p> Uses the same parameters and does the same internal checks as
 <a href="../modules/Babelfish.html#find_prototype_names">Babelfish.find_prototype_names</a> but does not conduct a search,
 and only returns the status code.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">pindex</span>



        </li>
        <li><span class="parameter">types</span>



        </li>
        <li><span class="parameter">options</span>



        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

           <span class="types"><a class="type" href="../api/Builtin-Types.html#boolean">boolean</a> or <a class="type" href="https://www.lua.org/pil/2.1.html">nil</a></span>



    </ol>




</dd>
    <dt>
    <a name = "get_player_language_code"></a>
    <strong>get_player_language_code(pindex)</strong>
    </dt>
    <dd>
    Retrieves the LanguageCode of a player.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">pindex</span>
            <span class="types"><a class="type" href="../modules/Types.html#NaturalNumber">NaturalNumber</a></span>
         A <a href="../api/LuaPlayer.html#LuaPlayer.index">LuaPlayer.index</a>.
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

        (<a href="../modules/Babelfish.html#LanguageCode">LanguageCode</a> or <a href="https://www.lua.org/pil/2.1.html">nil</a>).
    </ol>




</dd>
    <dt>
    <a name = "get_translation_percentages"></a>
    <strong>get_translation_percentages()</strong>
    </dt>
    <dd>
    Retrieves all translation percentages.
 This is the same data that the built-in status indicator uses.
 Includes only languages that have been seen on this map at least once.</p>

<p> This is the total percentage intended for GUI visualization only.
 Use <a href="../modules/Babelfish.html#can_find">Babelfish.can_find</a> to get the proper per-SearchType status.



    <h3>Returns:</h3>
    <ol>

           <span class="types"><a class="type" href="../lua-5.2/doc/manual.html#pdf-table">table</a></span>
         A mapping (<a href="../modules/Babelfish.html#LanguageCode">LanguageCode</a> → <a href="../modules/Types.html#NaturalNumber">NaturalNumber</a>)
 where the number is between 0 and 100 inclusive.
    </ol>




</dd>
    <dt>
    <a name = "force_update"></a>
    <strong>force_update([reset=false])</strong>
    </dt>
    <dd>
    Triggers an internal update. </p>

<p> This is meant to be used to circumvent the hard engine limitation of
 no events being raised in Singleplayer when the locale changes but
 nothing else changed.</p>

<p> This can also be triggered by the commands <code>&apos;/babelfish update&apos;</code>
 (singleplayer only) and <code>&apos;/babelfish reset&apos;</code> (admin only) respectively.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">reset</span>
            <span class="types"><a class="type" href="../api/Builtin-Types.html#boolean">boolean</a></span>
         Completely resets all translations
 instead of just performing a normal update.
         (<em>default</em> false)
        </li>
    </ul>





</dd>
</dl>
    <h2 class="section-header has-description"><a name="Commands"></a>Commands </h2>

          <div class="section-description">

          </div>
    <dl class="function">
    <dt>
    <a name = "update"></a>
    <strong>update</strong>
    </dt>
    <dd>
    <code>/babelfish update</code> Updates Singleplayer language when detection failed.







</dd>
    <dt>
    <a name = "reset"></a>
    <strong>reset</strong>
    </dt>
    <dd>
    <code>/babelfish reset</code> Deletes all translations and starts from scratch.
 Use only when everything else failed.







</dd>
    <dt>
    <a name = "dump"></a>
    <strong>dump</strong>
    </dt>
    <dd>
    <code>/babelfish dump</code> Prints internal statistics to the attached terminal.







</dd>
    <dt>
    <a name = "demo"></a>
    <strong>demo</strong>
    </dt>
    <dd>
    <code>/babelfish demo</code> Opens a rudimentary demonstration GUI.  Just type
 in the upper box to start searching. The gui is not optimized so the
 generation of the result icons is a bit slow for large modpacks.







</dd>
</dl>


</div> <!-- id="content" -->
</div> <!-- id="main" -->
<div id="about">
<i>generated by <a href="http://github.com/stevedonovan/LDoc">LDoc 1.4.6</a></i>
<i style="float:right;">Last updated 2021-06-12 01:04:16 </i>
</div> <!-- id="about" -->
</div> <!-- id="container" -->
</body>
</html>
